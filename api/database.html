---
layout: reference
title: Database
---
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Database </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="database_sec"></a>
Persist Objects</h1>
<p>When it comes to persistence you have to deal with sessions and transactions. You have to create a session for a specific database and wrap a transaction around your insertions or modifications.</p>
<p>After created a session objects you can either create the database schema ...</p>
<div class="fragment"><div class="line"><span class="comment">// the object store</span></div><div class="line">object_store ostore;</div><div class="line"></div><div class="line"><span class="comment">// configure object store</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="comment">// create and open a session</span></div><div class="line"><a class="code" href="/api/classoos_1_1session/index.html">oos::session</a> ses(ostore, <span class="stringliteral">&quot;sqlite://person.db&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// create the database schema</span></div><div class="line">ses.create();</div></div><!-- fragment --><p>... or load the data from database.</p>
<div class="fragment"><div class="line"><span class="comment">// load the data from database</span></div><div class="line">ses.load();</div></div><!-- fragment --><p>Once the schema is created or the data is loaded you can start and insert, update or delete your data. Therefor create a transaction object with the current session and start the transaction by calling <a class="el" href="/api/classoos_1_1transaction/index.html#a799e096658e74fd29944d895847b6193" title="Start a new transaction. ">oos::transaction::begin()</a>. After completing your modifications call <a class="el" href="/api/classoos_1_1transaction/index.html#a3b7de532a0981a71e0c90e43e0502517" title="Finish transaction. ">oos::transaction::commit()</a> to commit all your modifications to the database. If in error occurred while doing your modifications catch the exception. In the catch block you can call <a class="el" href="/api/classoos_1_1transaction/index.html#a6a782aaa33242b3212c8cff17ea52a94" title="Rollback transaction. ">oos::transaction::rollback()</a> to rollback all your modifications.</p>
<div class="fragment"><div class="line"><span class="comment">// create a transaction for session</span></div><div class="line"></div><div class="line"><a class="code" href="/api/classoos_1_1transaction/index.html">oos::transaction</a> tr(ses);</div><div class="line"><span class="keywordflow">try</span> {</div><div class="line">  <span class="comment">// begin the transaction</span></div><div class="line">  tr.begin();</div><div class="line"></div><div class="line">  <span class="comment">// insert some objects</span></div><div class="line">  ostore.insert(<span class="keyword">new</span> person(<span class="stringliteral">&quot;joe&quot;</span>, 45))</div><div class="line">  ostore.insert(<span class="keyword">new</span> person(<span class="stringliteral">&quot;walter&quot;</span>, 56));</div><div class="line">  ostore.insert(<span class="keyword">new</span> person(<span class="stringliteral">&quot;helen&quot;</span>, 37));</div><div class="line">  ostore.insert(<span class="keyword">new</span> person(<span class="stringliteral">&quot;tim&quot;</span>, 14));</div><div class="line"></div><div class="line">  <span class="comment">// commit the modifications</span></div><div class="line">  tr.commit();</div><div class="line">} <span class="keywordflow">catch</span> (exception &amp;ex) {</div><div class="line">  <span class="comment">// on error rollback transactions</span></div><div class="line">  tr.rollback();</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="support_sec"></a>
Supported Databases</h1>
<p>There're currently three supported databases and the in memory database. But more databases will follow. Next is the description of the database connection string for the supported databases.</p>
<h2><a class="anchor" id="mssql_sec"></a>
MS SQL Server</h2>
<div class="fragment"><div class="line"><span class="comment">// MSSQL connection string with password</span></div><div class="line">session ses(ostore, <span class="stringliteral">&quot;mssql://user:passwd@host/db&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// MSSQL connection string without password</span></div><div class="line">session ses(ostore, <span class="stringliteral">&quot;mssql://user@host/db&quot;</span>);</div></div><!-- fragment --><h2><a class="anchor" id="mysql_sec"></a>
MySQL</h2>
<div class="fragment"><div class="line"><span class="comment">// MySQL connection string with password</span></div><div class="line">session ses(ostore, <span class="stringliteral">&quot;mysql://user:passwd@host/db&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// MySQL connection string without password</span></div><div class="line">session ses(ostore, <span class="stringliteral">&quot;mysql://user@host/db&quot;</span>);</div></div><!-- fragment --><h2><a class="anchor" id="sqlite_sec"></a>
SQLite</h2>
<div class="fragment"><div class="line"><span class="comment">// MySQL connection string</span></div><div class="line">session ses(ostore, <span class="stringliteral">&quot;sqlite://database.sqlite&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="db_relation_sec"></a>
Relations on Database</h1>
<p>In short: All kinds of supported relations (list, vector and linked_list) are working out of the box. You don't have to worry about saving and loading relations.</p>
<p>The long description: When loading a relation from database at least two object types/tables are involved the parent and the children. With theses two participans we deal with two scenarios: The parent is loaded before its children and the children are loaded first.</p>
<p><b>Scenario 1:</b> Parents are loaded first. Everything is fine. We mark the parent as loaded and when the children table is loaded all parent objects can be filled with their children.</p>
<p><b>Scenario 2:</b> Children are loaded first. Because the parents aren't available placeholders with their ids are created from the id stored in the concrete children. Furthermore temporary lists are build up holding all children for each parent. When finally the parents are loaded these lists are used to the concrete parent container. </p>
</div></div><!-- contents -->
